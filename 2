<!doctype html>

<html>
  <head>
<meta name = "viewport" content = "initial-scale = 1.0">
<style>
  * {
    font-family: Courier;
    margin: 0; paddig: 0;
  }
</style>
<script src="underscore-min.js"></script>
<script src="zepto.min.js"></script>
</head>
<body style="height:1200px;">
  <div id="w">
  </div>
  <div id="k">
  </div>
</body>
<script>
  setTimeout(function () { window.scrollTo(0, 1) }, 100)

  var line  = []
  var lines = [line]
  var x_offset = 0
  var y_offset = 0
  var screen_width = 320
  viewport_x = 16

  var screen_height = 160
  viewport_y = 6

  font_size = 35
  w = $("#w")
  var cells = []
  var setup_screen = function () {
    cells = []
    for (var y = 0; y < viewport_y; y++) {
      for (var x = 0; x < viewport_x; x++) {
        var chr = $("<div>");
        var width = (screen_width / viewport_x)
        var height = (screen_height / viewport_y)
        chr.css({
          "left": x*width,
          "top": y*height,
          "position": "absolute",
          "width":  width + "px",
          "height":  height + "px",
          "font-size":  font_size + "px"
        })
        chr.attr("id", "c" + x + "_" + y)
        cells.push(chr)
        chr.text("a")
        w.append(chr)
      } 
    }
  }

  var clear = function () {
    for (var y = 0; y < viewport_y; y++) {
      for (var x = 0; x < viewport_x; x++) {
        var cell = cells[viewport_x * y + x]
        cell.text("")
      }
    }
  }

  var render = function (x_offset, y_offset) {
    clear()
    var c_line
    for (var y = y_offset; y < lines.length; y++) {
      c_line = lines[y];
      for (var x = x_offset; x < c_line.length; x++) {
        var c_chr = c_line[x];
        var cell = cells[viewport_x * y + x]
        cell.text(c_chr)
      }
    }
  }
  var text_to_lines = function (text) {
    var lines = text.split("\n");
    for (var i = 0; i < lines.length; i++) {
      var line = lines[i];
      lines[i] = line.split("");
    }
    return lines
  }
  setup_screen();
  var log_index = 0
  var l = function(m){
    log_index += 1
    document.title = 
      log_index + " " + m
  }


  var touchstart = function (e) {
    e.preventDefault()
    touch.y1 = e.touches[0].pageY
    touch.x1 = e.touches[0].pageX
  }
     
  //https://github.com/drewlesueur/mobile/blob/server/public/index.js
  var touchmove = function  (e) {
    touch.y2 = e.touches[0].pageY
    touch.x2 = e.touches[0].pageX
    var temp_x_offset = x_offset + touch.x2 - touch.x1)
    var temp_y_offset = y_offset + touch.y2 - touch.y1)
    render(scrollIndex + touch.y2 - touch.y1)   

    e.preventDefault()
  }

  var touchend = function (e) {
    scrollIndex = scrollIndex + touch.y2 - touch.y1
    if (scrollIndex < -maxTime) scrollIndex = -maxTime
    if (scrollIndex > minTime) scrollIndex = minTime
    // this is kinda backwards because I am multiplying by -1 
  } 


    $(document).ready(function () {
      $(document.body).bind("touchstart", touchstart)
      $(document.body).bind("touchmove", touchmove)
      $(document.body).bind("touchend", touchend)
      render(0)
    })



  var code = "yo\nworld" //prompt("code")
  lines = text_to_lines(code)
  render()
</script>
</html>

